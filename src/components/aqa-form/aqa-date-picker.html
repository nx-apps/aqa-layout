<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="./aqa-date-icon.html">
<link rel="import" href="../../../bower_components/iron-validator-behavior/iron-validator-behavior.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input-container.html">
<link rel="import" href="../../../bower_components/iron-input/iron-input.html">

<link rel="import" href="./aqa-date-picker-light.html">
<link rel="import" href="../aqa-font/aqa-trirong-font.html">

<dom-module id="aqa-date-picker">
  <template>
    <style>
    </style>
    <!-- <aqa-date-picker-light selected="{{selected}}" selected-be="{{selectedBe}}" show-bc="{{showBc}}" ></aqa-date-picker-light> -->
    <!-- <aqa-date-picker-light></aqa-date-picker-light> -->
    <slot id="slot"></slot>

  </template>

  <script>

    class AqaDatePicker extends Polymer.mixinBehaviors([Polymer.IronValidatorBehavior], Polymer.Element) {

      static get is() { return 'aqa-date-picker'; }
      static get properties() {
        return {
          showBc: {
            type: Boolean,
            value: false
          },
          selected: {
            type: String,
            notify: true
            // value: '2017-09-15',
            // 2017-1-15
          },
          selectedBe: {
            type: String,
            notify: true,
            //value:'15/9/2560'
          },
        }
      }
      constructor() {
        super()

        if (!window.aqaDataPickerSection) {
          window.aqaDataPickerSection = document.createElement('aqa-date-picker-light')
          window.aqaDataPickerSection.id = "aqaDataPickerLight"
          document.querySelector('body').appendChild(window.aqaDataPickerSection)
        }

      }

      connectedCallback() {
        super.connectedCallback()
        setTimeout(() => {

          this.child = this.children[0]
          this.nativeInput = this.child.$.nativeInput
          this.nativeInput.addEventListener('focus', this._showDatePicker.bind(this))
          this.nativeInput.addEventListener('blur', this._hideDatePicker.bind(this))

          this.aqaDataPickerLight = document.getElementById('aqaDataPickerLight')
          this.calendar = aqaDataPickerLight.$.calendar

        }, 1)

      }

      _showDatePicker() {

        this.child.addEventListener('value-changed', this._childValueChanged.bind(this))

        this.aqaDataPickerLight.child = this.child

        this.calendar.style.display = "block"
        var bodyHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight

        var offsetChild = this.child.getBoundingClientRect()
        var offsetCalendar = this.calendar.getBoundingClientRect()

        if (
          (bodyHeight - (offsetChild.top + offsetChild.height)) > offsetCalendar.height
        ) {
          this.calendar.style.left = (offsetChild.left + offsetChild.width - offsetCalendar.width) + 'px';
          this.calendar.style.top = (offsetChild.top + offsetChild.height) + 'px';
        } else {
          this.calendar.style.left = (offsetChild.left + offsetChild.width - offsetCalendar.width) + 'px';
          this.calendar.style.top = (offsetChild.top - offsetCalendar.height) + 'px';
        }

      }

      _hideDatePicker() {
        setTimeout(() => {
          this.calendar.style.display = "none"
        }, 100)

      }

      _childValueChanged(e) {
        var value = e.target.value
        var valueInput = "";

        valueInput += value.substring(0, 2)
        if (value.length > 2) {
          valueInput += '/'
        }
        valueInput += value.substring(2, 4)
        if (value.length > 4) {
          valueInput += '/'
        }
        valueInput += value.substring(4, 8)

        // console.log(this.aqaDataPickerLight.selectBe)
        this.aqaDataPickerLight.selectedBe = valueInput
      }



    }

    window.customElements.define(AqaDatePicker.is, AqaDatePicker);
  </script>
</dom-module>